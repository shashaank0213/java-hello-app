pipeline {
  agent any

  environment {
    IMAGE_NAME = "java-hello-app"
    CONTAINER_NAME = "java-hello-container"
    PORT = "8090"
  }

  stages {
    stage('Clone') {
      steps {
        checkout scm
      }
    }

    stage('Build JAR') {
      steps {
        sh 'mvn clean package -DskipTests'
      }
    }

    stage('Build Docker Image') {
      steps {
        sh 'docker build -t ${IMAGE_NAME}:latest .'
      }
    }

    stage('Run Docker Container') {
      steps {
        script {
          // Stop and remove any existing with the same name
          sh "docker rm -f ${CONTAINER_NAME} || true"

          // Run the container
          sh """
            docker run -d --name ${CONTAINER_NAME} -p ${PORT}:8090 ${IMAGE_NAME}
          """}
      }
    }
  }
}
